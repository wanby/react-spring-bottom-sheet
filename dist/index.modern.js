import e from"@reach/portal";import n,{useRef as t,useDebugValue as r,useEffect as a,useLayoutEffect as o,useState as i,useCallback as c,useMemo as s,useImperativeHandle as l,forwardRef as u}from"react";import{useMachine as d}from"@xstate/react";import{useSpring as p,interpolate as y,animated as g,config as m}from"react-spring";import{useDrag as f,rubberbandIfOutOfBounds as S}from"react-use-gesture";import{createFocusTrap as v}from"focus-trap";import{disableBodyScroll as h,enableBodyScroll as E}from"body-scroll-lock";import{ResizeObserver as b}from"@juggle/resize-observer";import{Machine as R,assign as w}from"xstate";function O(){return(O=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function x(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n.indexOf(t=o[r])>=0||(a[t]=e[t]);return a}const C="undefined"!=typeof window?o:a;function N(e,n,t){return n=(n=+n)==n?n:0,t=(t=+t)==t?t:0,(e=+e)==e&&(e=(e=e<=t?e:t)>=n?e:n),e}function H(e){const n=Math.round(e);if(Number.isNaN(e))throw new TypeError("Found a NaN! Check your snapPoints / defaultSnap / snapTo ");return n}const k={box:"border-box"};function D(e,{label:n,enabled:t,resizeSourceRef:a}){let[o,s]=i(0);r(`${n}: ${o}`);const l=c(e=>{s(e[0].borderBoxSize[0].blockSize),a.current="element"},[a]);return C(()=>{if(!e.current||!t)return;const n=new b(l);return n.observe(e.current,k),()=>{n.disconnect()}},[e,l,t]),t?o:0}function z(e=1e3){return new Promise(n=>setTimeout(n,e))}const P={DRAG:{target:"#overlay.dragging",actions:"onOpenEnd"}},A={RESIZE:{target:"#overlay.resizing",actions:"onOpenEnd"}},L=R({id:"overlay",initial:"closed",context:{initialState:"CLOSED"},states:{closed:{on:{OPEN:"opening",CLOSE:void 0}},opening:{initial:"start",states:{start:{invoke:{src:"onOpenStart",onDone:"transition"}},transition:{always:[{target:"immediately",cond:"initiallyOpen"},{target:"smoothly",cond:"initiallyClosed"}]},immediately:{initial:"open",states:{open:{invoke:{src:"openImmediately",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"#overlay.opening.end"},on:O({},P,A)}}},smoothly:{initial:"visuallyHidden",states:{visuallyHidden:{invoke:{src:"renderVisuallyHidden",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"open"}},open:{invoke:{src:"openSmoothly",onDone:"#overlay.opening.end"},on:O({},P,A)}}},end:{invoke:{src:"onOpenEnd",onDone:"done"},on:{CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:O({},{CLOSE:{target:"#overlay.closing",actions:"onOpenCancel"}}),onDone:"open"},open:{on:{DRAG:"#overlay.dragging",SNAP:"snapping",RESIZE:"resizing"}},dragging:{on:{SNAP:"snapping"}},snapping:{initial:"start",states:{start:{invoke:{src:"onSnapStart",onDone:"snappingSmoothly"},entry:[w({y:(e,{payload:{y:n}})=>n,velocity:(e,{payload:{velocity:n}})=>n,snapSource:(e,{payload:{source:n="custom"}})=>n})]},snappingSmoothly:{invoke:{src:"snapSmoothly",onDone:"end"}},end:{invoke:{src:"onSnapEnd",onDone:"done"},on:{RESIZE:"#overlay.resizing",SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{SNAP:{target:"snapping",actions:"onSnapEnd"},RESIZE:{target:"#overlay.resizing",actions:"onSnapCancel"},DRAG:{target:"#overlay.dragging",actions:"onSnapCancel"},CLOSE:{target:"#overlay.closing",actions:"onSnapCancel"}},onDone:"open"},resizing:{initial:"start",states:{start:{invoke:{src:"onResizeStart",onDone:"resizingSmoothly"}},resizingSmoothly:{invoke:{src:"resizeSmoothly",onDone:"end"}},end:{invoke:{src:"onResizeEnd",onDone:"done"},on:{SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{RESIZE:{target:"resizing",actions:"onResizeEnd"},SNAP:{target:"snapping",actions:"onResizeCancel"},DRAG:{target:"#overlay.dragging",actions:"onResizeCancel"},CLOSE:{target:"#overlay.closing",actions:"onResizeCancel"}},onDone:"open"},closing:{initial:"start",states:{start:{invoke:{src:"onCloseStart",onDone:"deactivating"},on:{OPEN:{target:"#overlay.open",actions:"onCloseCancel"}}},deactivating:{invoke:{src:"deactivate",onDone:"closingSmoothly"}},closingSmoothly:{invoke:{src:"closeSmoothly",onDone:"end"}},end:{invoke:{src:"onCloseEnd",onDone:"done"},on:{OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}}},done:{type:"final"}},on:{CLOSE:void 0,OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}},onDone:"closed"}},on:{CLOSE:"closing"}},{actions:{onOpenCancel:(e,n)=>{},onSnapCancel:(e,n)=>{},onResizeCancel:(e,n)=>{},onCloseCancel:(e,n)=>{},onOpenEnd:(e,n)=>{},onSnapEnd:(e,n)=>{},onRezizeEnd:(e,n)=>{}},services:{onSnapStart:async()=>{await z()},onOpenStart:async()=>{await z()},onCloseStart:async()=>{await z()},onResizeStart:async()=>{await z()},onSnapEnd:async()=>{await z()},onOpenEnd:async()=>{await z()},onCloseEnd:async()=>{await z()},onResizeEnd:async()=>{await z()},renderVisuallyHidden:async(e,n)=>{await z()},activate:async(e,n)=>{await z()},deactivate:async(e,n)=>{await z()},openSmoothly:async(e,n)=>{await z()},openImmediately:async(e,n)=>{await z()},snapSmoothly:async(e,n)=>{await z()},resizeSmoothly:async(e,n)=>{await z()},closeSmoothly:async(e,n)=>{await z()}},guards:{initiallyClosed:({initialState:e})=>"CLOSED"===e,initiallyOpen:({initialState:e})=>"OPEN"===e}}),{tension:T,friction:M}=m.default,I=n.forwardRef(function(e,o){let{children:u,sibling:m,className:b,topOffset:R,springConfig:w,footer:k,header:z,open:P,initialState:A,lastSnapRef:I,initialFocusRef:B,onDismiss:$,maxHeight:j,defaultSnap:V=F,snapPoints:q=Z,blocking:K=!0,scrollLocking:J=!0,style:Q,onSpringStart:U,onSpringCancel:W,onSpringEnd:X,reserveScrollBarGap:Y=K}=e,_=x(e,["children","sibling","className","topOffset","springConfig","footer","header","open","initialState","lastSnapRef","initialFocusRef","onDismiss","maxHeight","defaultSnap","snapPoints","blocking","scrollLocking","style","onSpringStart","onSpringCancel","onSpringEnd","reserveScrollBarGap"]);const{ready:ee,registerReady:ne}=function(){const[e,n]=i(!1),[t,r]=i({}),o=c(e=>(r(n=>O({},n,{[e]:!1})),()=>{r(n=>O({},n,{[e]:!0}))}),[]);return a(()=>{const e=Object.values(t);0!==e.length&&e.every(Boolean)&&n(!0)},[t]),{ready:e,registerReady:o}}(),te=t(!1),re=t(U),ae=t(W),oe=t(X);a(()=>{re.current=U,ae.current=W,oe.current=X},[W,U,X]);const[ie,ce]=p(()=>({y:0,ready:0,maxHeight:0,minSnap:0,maxSnap:0,topOffset:0})),se=t(null),le=t(null),ue=t(null),de=t(null),pe=t(null),ye=t(null),ge=t(0),me=t(),fe=function(){const e=s(()=>"undefined"!=typeof window?window.matchMedia("(prefers-reduced-motion: reduce)"):null,[]),n=t(null==e?void 0:e.matches);return r(n.current?"reduce":"no-preference"),a(()=>{const t=e=>{n.current=e.matches};return null==e||e.addListener(t),()=>null==e?void 0:e.removeListener(t)},[e]),n}(),Se=function({targetRef:e,enabled:n,reserveScrollBarGap:o}){const i=t({activate:()=>{throw new TypeError("Tried to activate scroll lock too early")},deactivate:()=>{}});return r(n?"Enabled":"Disabled"),a(()=>{if(!n)return i.current.deactivate(),void(i.current={activate:()=>{},deactivate:()=>{}});const t=e.current;let r=!1;i.current={activate:()=>{r||(r=!0,h(t,{allowTouchMove:e=>e.closest("[data-body-scroll-lock-ignore]"),reserveScrollBarGap:o}))},deactivate:()=>{r&&(r=!1,E(t))}}},[n,e,o]),i}({targetRef:le,enabled:ee&&J,reserveScrollBarGap:Y}),ve=function({targetRef:e,enabled:n}){const o=t({activate:()=>{throw new TypeError("Tried to activate aria hider too early")},deactivate:()=>{}});return r(n?"Enabled":"Disabled"),a(()=>{if(!n)return o.current.deactivate(),void(o.current={activate:()=>{},deactivate:()=>{}});const t=e.current;let r=!1,a=[],i=[];o.current={activate:()=>{if(r)return;r=!0;const e=t.parentNode;document.querySelectorAll("body > *").forEach(n=>{if(n===e)return;let t=n.getAttribute("aria-hidden");null!==t&&"false"!==t||(a.push(t),i.push(n),n.setAttribute("aria-hidden","true"))})},deactivate:()=>{r&&(r=!1,i.forEach((e,n)=>{let t=a[n];null===t?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",t)}),a=[],i=[])}}},[e,n]),o}({targetRef:se,enabled:ee&&K}),he=function({targetRef:e,fallbackRef:n,initialFocusRef:o,enabled:i}){const c=t({activate:()=>{throw new TypeError("Tried to activate focus trap too early")},deactivate:()=>{}});return r(i?"Enabled":"Disabled"),a(()=>{if(!i)return c.current.deactivate(),void(c.current={activate:()=>{},deactivate:()=>{}});const t=n.current,r=v(e.current,{onActivate:void 0,initialFocus:o?()=>(null==o?void 0:o.current)||t:void 0,fallbackFocus:t,escapeDeactivates:!1,clickOutsideDeactivates:!1});let a=!1;c.current={activate:async()=>{a||(a=!0,await r.activate(),await new Promise(e=>setTimeout(()=>e(void 0),0)))},deactivate:()=>{a&&(a=!1,r.deactivate())}}},[i,n,o,e]),c}({targetRef:se,fallbackRef:ye,initialFocusRef:B,enabled:ee&&K}),{minSnap:Ee,maxSnap:be,maxHeight:Re,findSnap:we}=function({contentRef:e,controlledMaxHeight:n,footerEnabled:o,footerRef:c,getSnapPoints:l,headerEnabled:u,headerRef:d,heightRef:p,lastSnapRef:y,ready:g,registerReady:m,resizeSourceRef:f}){const{maxHeight:S,minHeight:v,headerHeight:h,footerHeight:E}=function({contentRef:e,controlledMaxHeight:n,footerEnabled:o,footerRef:c,headerEnabled:l,headerRef:u,registerReady:d,resizeSourceRef:p}){const y=s(()=>d("contentHeight"),[d]),g=function(e,n,o){const c=s(()=>n("maxHeight"),[n]),[l,u]=i(()=>H(e)||"undefined"!=typeof window?window.innerHeight:0),d=l>0,p=t(0);return r(e?"controlled":"auto"),a(()=>{d&&c()},[d,c]),C(()=>{if(e)return u(H(e)),void(o.current="maxheightprop");const n=()=>{p.current||(p.current=requestAnimationFrame(()=>{u(window.innerHeight),o.current="window",p.current=0}))};return window.addEventListener("resize",n),u(window.innerHeight),o.current="window",c(),()=>{window.removeEventListener("resize",n),cancelAnimationFrame(p.current)}},[e,c,o]),l}(n,d,p),m=D(u,{label:"headerHeight",enabled:l,resizeSourceRef:p}),f=D(e,{label:"contentHeight",enabled:!0,resizeSourceRef:p}),S=D(c,{label:"footerHeight",enabled:o,resizeSourceRef:p}),v=Math.min(g-m-S,f)+m+S;r(`minHeight: ${v}`);const h=f>0;return a(()=>{h&&y()},[h,y]),{maxHeight:g,minHeight:v,headerHeight:m,footerHeight:S}}({contentRef:e,controlledMaxHeight:n,footerEnabled:o,footerRef:c,headerEnabled:u,headerRef:d,registerReady:m,resizeSourceRef:f}),{snapPoints:b,minSnap:R,maxSnap:w}=function(e,n){const t=[].concat(e).map(H).reduce((e,t)=>(e.add(N(t,0,n)),e),new Set),r=Array.from(t),a=Math.min(...r);if(Number.isNaN(a))throw new TypeError("minSnap is NaN");const o=Math.max(...r);if(Number.isNaN(o))throw new TypeError("maxSnap is NaN");return{snapPoints:r,minSnap:a,maxSnap:o}}(g?l({height:p.current,footerHeight:E,headerHeight:h,minHeight:v,maxHeight:S}):[0],S);return r(`minSnap: ${R}, maxSnap:${w}`),{minSnap:R,maxSnap:w,findSnap:function(e){let n;n="function"==typeof e?e({footerHeight:E,headerHeight:h,height:p.current,minHeight:v,maxHeight:S,snapPoints:b,lastSnap:y.current}):e;const t=H(n);return b.reduce((e,n)=>Math.abs(n-t)<Math.abs(e-t)?n:e,R)},maxHeight:S}}({contentRef:ue,controlledMaxHeight:j,footerEnabled:!!k,footerRef:pe,getSnapPoints:q,headerEnabled:!1!==z,headerRef:de,heightRef:ge,lastSnapRef:I,ready:ee,registerReady:ne,resizeSourceRef:me}),Oe=t(Re),xe=t(Ee),Ce=t(be),Ne=t(we),He=t(0),ke=t(R||0);C(()=>{Oe.current=Re,Ce.current=be,xe.current=Ee,Ne.current=we,He.current=we(V)},[we,V,Re,be,Ee]);const De=c(e=>{let{onRest:n,config:{velocity:t=1}={}}=e,r=x(e.config,["velocity"]),a=x(e,["onRest","config"]);return new Promise(e=>ce(O({},a,{config:O({velocity:t},r,{mass:1,tension:T,friction:Math.max(M,M+(M-M*t))},w),onRest:(...t)=>{e(...t),null==n||n(...t)}})))},[ce]),[ze,Pe]=d(L,{devTools:!1,actions:{onOpenCancel:c(()=>null==ae.current?void 0:ae.current({type:"OPEN"}),[]),onSnapCancel:c(e=>null==ae.current?void 0:ae.current({type:"SNAP",source:e.snapSource}),[]),onCloseCancel:c(()=>null==ae.current?void 0:ae.current({type:"CLOSE"}),[]),onResizeCancel:c(()=>null==ae.current?void 0:ae.current({type:"RESIZE",source:me.current}),[]),onOpenEnd:c(()=>null==oe.current?void 0:oe.current({type:"OPEN"}),[]),onSnapEnd:c((e,n)=>null==oe.current?void 0:oe.current({type:"SNAP",source:e.snapSource}),[]),onResizeEnd:c(()=>null==oe.current?void 0:oe.current({type:"RESIZE",source:me.current}),[])},context:{initialState:A},services:{onSnapStart:c(async(e,n)=>null==re.current?void 0:re.current({type:"SNAP",source:n.payload.source||"custom"}),[]),onOpenStart:c(async()=>null==re.current?void 0:re.current({type:"OPEN"}),[]),onCloseStart:c(async()=>null==re.current?void 0:re.current({type:"CLOSE"}),[]),onResizeStart:c(async()=>null==re.current?void 0:re.current({type:"RESIZE",source:me.current}),[]),onSnapEnd:c(async(e,n)=>null==oe.current?void 0:oe.current({type:"SNAP",source:e.snapSource}),[]),onOpenEnd:c(async()=>null==oe.current?void 0:oe.current({type:"OPEN"}),[]),onCloseEnd:c(async()=>null==oe.current?void 0:oe.current({type:"CLOSE"}),[]),onResizeEnd:c(async()=>null==oe.current?void 0:oe.current({type:"RESIZE",source:me.current}),[]),renderVisuallyHidden:c(async(e,n)=>{await De({y:He.current,ready:0,maxHeight:Oe.current,maxSnap:Ce.current,minSnap:He.current,immediate:!0,topOffset:ke.current})},[De]),activate:c(async(e,n)=>{te.current=!0,await Promise.all([Se.current.activate(),he.current.activate(),ve.current.activate()])},[ve,he,Se]),deactivate:c(async()=>{Se.current.deactivate(),he.current.deactivate(),ve.current.deactivate(),te.current=!1},[ve,he,Se]),openImmediately:c(async()=>{ge.current=He.current,await De({y:He.current,ready:1,maxHeight:Oe.current,maxSnap:Ce.current,minSnap:He.current,immediate:!0,topOffset:ke.current})},[De]),openSmoothly:c(async()=>{await De({y:0,ready:1,maxHeight:Oe.current,maxSnap:Ce.current,minSnap:He.current,immediate:!0,topOffset:ke.current}),ge.current=He.current,await De({y:He.current,ready:1,maxHeight:Oe.current,maxSnap:Ce.current,minSnap:He.current,immediate:fe.current,topOffset:ke.current})},[De,fe]),snapSmoothly:c(async(e,n)=>{const t=Ne.current(e.y);ge.current=t,I.current=t,await De({y:t,ready:1,maxHeight:Oe.current,maxSnap:Ce.current,minSnap:xe.current,immediate:fe.current,topOffset:ke.current,config:{velocity:e.velocity}})},[De,I,fe]),resizeSmoothly:c(async()=>{const e=Ne.current(ge.current);ge.current=e,I.current=e,await De({y:e,ready:1,maxHeight:Oe.current,maxSnap:Ce.current,minSnap:xe.current,topOffset:ke.current,immediate:"element"!==me.current||fe.current})},[De,I,fe]),closeSmoothly:c(async(e,n)=>{De({minSnap:ge.current,immediate:!0}),ge.current=0,await De({y:0,maxHeight:Oe.current,maxSnap:Ce.current,immediate:fe.current}),await De({ready:0,immediate:!0})},[De,fe])}});a(()=>{ee&&Pe(P?"OPEN":"CLOSE")},[P,Pe,ee]),C(()=>{(Re||be||Ee)&&Pe("RESIZE")},[Re,be,Ee,Pe]),a(()=>()=>{Se.current.deactivate(),he.current.deactivate(),ve.current.deactivate()},[ve,he,Se]),l(o,()=>({snapTo:(e,{velocity:n=1,source:t="custom"}={})=>{Pe("SNAP",{payload:{y:Ne.current(e),velocity:n,source:t}})},get height(){return ge.current}}),[Pe]);const Ae=f(({args:[{closeOnTap:e=!1}={}]=[],cancel:n,direction:[,t],down:r,first:a,last:o,memo:i=ie.y.getValue(),movement:[,c],tap:s,velocity:l})=>{const u=-1*c;if(!te.current)return n(),i;if($&&e&&s)return n(),setTimeout(()=>$(),0),i;if(s)return i;const d=i+u,p=u*l,y=Math.max(xe.current,Math.min(Ce.current,d+2*p));if(!r&&$&&t>0&&d+p<xe.current/2)return n(),$(),i;let g=r?$||xe.current!==Ce.current?S(d,$?0:xe.current,Ce.current,.85):d<xe.current?S(d,xe.current,2*Ce.current,.85):S(d,xe.current/2,Ce.current,.85):y;return a&&Pe("DRAG"),o?(Pe("SNAP",{payload:{y:g,velocity:l>.05?l:1,source:"dragging"}}),i):(ce({y:g,ready:1,maxHeight:Oe.current,maxSnap:Ce.current,minSnap:xe.current,topOffset:ke.current,immediate:!0,config:{velocity:l}}),i)},{filterTaps:!0});if(Number.isNaN(Ce.current))throw new TypeError("maxSnapRef is NaN!!");if(Number.isNaN(xe.current))throw new TypeError("minSnapRef is NaN!!");const Le=function({spring:e}){const n=y([e.y,e.maxHeight,e.topOffset],(e,n,t)=>`${Math.round(N(n-e-(t||0),0,16))}px`),t=y([e.y,e.minSnap,e.maxSnap],(e,n,t)=>`${N(e,n,t)}px`),r=y([e.y,e.minSnap,e.maxSnap],(e,n,t)=>e<n?n-e+"px":e>t?t-e+"px":"0px"),a=y([e.y,e.maxSnap],(e,n)=>e>=n?Math.ceil(e-n):0);return{"--rsbs-content-opacity":y([e.y,e.minSnap],(e,n)=>{if(!n)return 0;const t=Math.max(n/2-45,0);return N((e-t)*(1/(Math.min(n/2+45,n)-t)+0),0,1)}),"--rsbs-backdrop-opacity":y([e.y,e.minSnap],(e,n)=>n?N(e/n,0,1):0),"--rsbs-antigap-scale-y":a,"--rsbs-overlay-translate-y":r,"--rsbs-overlay-rounded":n,"--rsbs-overlay-h":t}}({spring:ie});return n.createElement(g.div,O({},_,{"data-rsbs-root":!0,"data-rsbs-state":G.find(ze.matches),"data-rsbs-is-blocking":K,"data-rsbs-is-dismissable":!!$,"data-rsbs-has-header":!!z,"data-rsbs-has-footer":!!k,className:b,ref:se,style:O({},Le,Q,{opacity:ie.ready})}),m,K&&n.createElement("div",O({key:"backdrop","data-rsbs-backdrop":!0},Ae({closeOnTap:!0}))),n.createElement("div",{key:"overlay","aria-modal":"true",role:"dialog","data-rsbs-overlay":!0,tabIndex:-1,ref:ye,onKeyDown:e=>{"Escape"===e.key&&(e.stopPropagation(),$&&$())}},!1!==z&&n.createElement("div",O({key:"header","data-rsbs-header":!0,ref:de},Ae()),z),n.createElement("div",{key:"scroll","data-rsbs-scroll":!0,ref:le},n.createElement("div",{"data-rsbs-content":!0,ref:ue},u)),k&&n.createElement("div",O({key:"footer",ref:pe,"data-rsbs-footer":!0},Ae()),k)))}),G=["closed","opening","open","closing","dragging","snapping","resizing"];function F({snapPoints:e,lastSnap:n}){return null!=n?n:Math.min(...e)}function Z({minHeight:e}){return e}const B=u(function(r,a){let{onSpringStart:o,onSpringEnd:s,skipInitialTransition:l}=r,u=x(r,["onSpringStart","onSpringEnd","skipInitialTransition"]);const[d,p]=i(!1),y=t(),g=t(null),m=t(l&&u.open?"OPEN":"CLOSED");C(()=>{if(u.open)return cancelAnimationFrame(y.current),p(!0),()=>{m.current="CLOSED"}},[u.open]);const f=c(async function(e){await(null==o?void 0:o(e)),"OPEN"===e.type&&cancelAnimationFrame(y.current)},[o]),S=c(async function(e){await(null==s?void 0:s(e)),"CLOSE"===e.type&&(y.current=requestAnimationFrame(()=>p(!1)))},[s]);return d?n.createElement(e,{"data-rsbs-portal":!0},n.createElement(I,O({},u,{lastSnapRef:g,ref:a,initialState:m.current,onSpringStart:f,onSpringEnd:S}))):null});export{B as BottomSheet};
//# sourceMappingURL=index.modern.js.map
