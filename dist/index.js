var e=require("@reach/portal"),n=require("react"),t=require("@xstate/react"),r=require("react-spring"),o=require("react-use-gesture"),i=require("focus-trap"),a=require("@juggle/resize-observer"),c=require("xstate");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=u(e),l=u(n);function f(){return(f=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function d(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n.indexOf(t=i[r])>=0||(o[t]=e[t]);return o}var v="undefined"!=typeof window?n.useLayoutEffect:n.useEffect,p=!1;if("undefined"!=typeof window){var m={get passive(){p=!0}};window.addEventListener("testPassive",null,m),window.removeEventListener("testPassive",null,m)}var g,h,y="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),S=[],E=!1,b=-1,P=function(e){return S.some(function(n){return!(!n.options.allowTouchMove||!n.options.allowTouchMove(e))})},R=function(e){var n=e||window.event;return!!P(n.target)||n.touches.length>1||(n.preventDefault&&n.preventDefault(),!1)},C=function(){void 0!==h&&(document.body.style.paddingRight=h,h=void 0),void 0!==g&&(document.body.style.overflow=g,g=void 0)},w=function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight};function O(e,n,t){return n=(n=+n)==n?n:0,t=(t=+t)==t?t:0,(e=+e)==e&&(e=(e=e<=t?e:t)>=n?e:n),e}function k(e){var n=Math.round(e);if(Number.isNaN(e))throw new TypeError("Found a NaN! Check your snapPoints / defaultSnap / snapTo ");return n}var x={box:"border-box"};function D(e,t){var r=t.label,o=t.enabled,i=t.resizeSourceRef,c=n.useState(0),u=c[0],s=c[1];n.useDebugValue(r+": "+u);var l=n.useCallback(function(e){s(e[0].borderBoxSize[0].blockSize),i.current="element"},[i]);return v(function(){if(e.current&&o){var n=new a.ResizeObserver(l);return n.observe(e.current,x),function(){n.disconnect()}}},[e,l,o]),o?u:0}function N(e){return void 0===e&&(e=1e3),new Promise(function(n){return setTimeout(n,e)})}var H={DRAG:{target:"#overlay.dragging",actions:"onOpenEnd"}},j={RESIZE:{target:"#overlay.resizing",actions:"onOpenEnd"}},z=c.Machine({id:"overlay",initial:"closed",context:{initialState:"CLOSED"},states:{closed:{on:{OPEN:"opening",CLOSE:void 0}},opening:{initial:"start",states:{start:{invoke:{src:"onOpenStart",onDone:"transition"}},transition:{always:[{target:"immediately",cond:"initiallyOpen"},{target:"smoothly",cond:"initiallyClosed"}]},immediately:{initial:"open",states:{open:{invoke:{src:"openImmediately",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"#overlay.opening.end"},on:f({},H,j)}}},smoothly:{initial:"visuallyHidden",states:{visuallyHidden:{invoke:{src:"renderVisuallyHidden",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"open"}},open:{invoke:{src:"openSmoothly",onDone:"#overlay.opening.end"},on:f({},H,j)}}},end:{invoke:{src:"onOpenEnd",onDone:"done"},on:{CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:f({},{CLOSE:{target:"#overlay.closing",actions:"onOpenCancel"}}),onDone:"open"},open:{on:{DRAG:"#overlay.dragging",SNAP:"snapping",RESIZE:"resizing"}},dragging:{on:{SNAP:"snapping"}},snapping:{initial:"start",states:{start:{invoke:{src:"onSnapStart",onDone:"snappingSmoothly"},entry:[c.assign({y:function(e,n){return n.payload.y},velocity:function(e,n){return n.payload.velocity},snapSource:function(e,n){var t=n.payload.source;return void 0===t?"custom":t}})]},snappingSmoothly:{invoke:{src:"snapSmoothly",onDone:"end"}},end:{invoke:{src:"onSnapEnd",onDone:"done"},on:{RESIZE:"#overlay.resizing",SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{SNAP:{target:"snapping",actions:"onSnapEnd"},RESIZE:{target:"#overlay.resizing",actions:"onSnapCancel"},DRAG:{target:"#overlay.dragging",actions:"onSnapCancel"},CLOSE:{target:"#overlay.closing",actions:"onSnapCancel"}},onDone:"open"},resizing:{initial:"start",states:{start:{invoke:{src:"onResizeStart",onDone:"resizingSmoothly"}},resizingSmoothly:{invoke:{src:"resizeSmoothly",onDone:"end"}},end:{invoke:{src:"onResizeEnd",onDone:"done"},on:{SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{RESIZE:{target:"resizing",actions:"onResizeEnd"},SNAP:{target:"snapping",actions:"onResizeCancel"},DRAG:{target:"#overlay.dragging",actions:"onResizeCancel"},CLOSE:{target:"#overlay.closing",actions:"onResizeCancel"}},onDone:"open"},closing:{initial:"start",states:{start:{invoke:{src:"onCloseStart",onDone:"deactivating"},on:{OPEN:{target:"#overlay.open",actions:"onCloseCancel"}}},deactivating:{invoke:{src:"deactivate",onDone:"closingSmoothly"}},closingSmoothly:{invoke:{src:"closeSmoothly",onDone:"end"}},end:{invoke:{src:"onCloseEnd",onDone:"done"},on:{OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}}},done:{type:"final"}},on:{CLOSE:void 0,OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}},onDone:"closed"}},on:{CLOSE:"closing"}},{actions:{onOpenCancel:function(e,n){},onSnapCancel:function(e,n){},onResizeCancel:function(e,n){},onCloseCancel:function(e,n){},onOpenEnd:function(e,n){},onSnapEnd:function(e,n){},onRezizeEnd:function(e,n){}},services:{onSnapStart:function(){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},onOpenStart:function(){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},onCloseStart:function(){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},onResizeStart:function(){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},onSnapEnd:function(){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},onOpenEnd:function(){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},onCloseEnd:function(){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},onResizeEnd:function(){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},renderVisuallyHidden:function(e,n){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},activate:function(e,n){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},deactivate:function(e,n){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},openSmoothly:function(e,n){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},openImmediately:function(e,n){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},snapSmoothly:function(e,n){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},resizeSmoothly:function(e,n){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}},closeSmoothly:function(e,n){try{return Promise.resolve(N()).then(function(){})}catch(e){return Promise.reject(e)}}},guards:{initiallyClosed:function(e){return"CLOSED"===e.initialState},initiallyOpen:function(e){return"OPEN"===e.initialState}}}),L=r.config.default,T=L.tension,A=L.friction,M=l.default.forwardRef(function(e,a){var c=e.children,u=e.sibling,s=e.className,m=e.topOffset,x=e.springConfig,N=e.ignoreLockClasses,H=e.footer,j=e.header,L=e.open,M=e.initialState,V=e.lastSnapRef,q=e.initialFocusRef,B=e.onDismiss,Z=e.maxHeight,W=e.defaultSnap,Y=void 0===W?F:W,K=e.snapPoints,J=void 0===K?G:K,Q=e.blocking,U=void 0===Q||Q,X=e.scrollLocking,$=void 0===X||X,_=e.style,ee=e.onSpringStart,ne=e.onSpringCancel,te=e.onSpringEnd,re=e.reserveScrollBarGap,oe=void 0===re?U:re,ie=e.expandOnContentDrag,ae=void 0!==ie&&ie,ce=d(e,["children","sibling","className","topOffset","springConfig","ignoreLockClasses","footer","header","open","initialState","lastSnapRef","initialFocusRef","onDismiss","maxHeight","defaultSnap","snapPoints","blocking","scrollLocking","style","onSpringStart","onSpringCancel","onSpringEnd","reserveScrollBarGap","expandOnContentDrag"]),ue=function(){var e=n.useState(!1),t=e[0],r=e[1],o=n.useState({}),i=o[0],a=o[1],c=n.useCallback(function(e){return a(function(n){var t;return f({},n,((t={})[e]=!1,t))}),function(){a(function(n){var t;return f({},n,((t={})[e]=!0,t))})}},[]);return n.useEffect(function(){var e=Object.values(i);0!==e.length&&e.every(Boolean)&&r(!0)},[i]),{ready:t,registerReady:c}}(),se=ue.ready,le=ue.registerReady,fe=n.useRef(!1),de=n.useRef(ee),ve=n.useRef(ne),pe=n.useRef(te);n.useEffect(function(){de.current=ee,ve.current=ne,pe.current=te},[ne,ee,te]);var me,ge,he=r.useSpring(function(){return{y:0,ready:0,maxHeight:0,minSnap:0,maxSnap:0,topOffset:0}}),ye=he[0],Se=he[1],Ee=n.useRef(null),be=n.useRef(null),Pe=n.useRef(null),Re=n.useRef(null),Ce=n.useRef(null),we=n.useRef(null),Oe=n.useRef(0),ke=n.useRef(),xe=n.useRef(!1),De=(me=n.useMemo(function(){return"undefined"!=typeof window?window.matchMedia("(prefers-reduced-motion: reduce)"):null},[]),ge=n.useRef(null==me?void 0:me.matches),n.useDebugValue(ge.current?"reduce":"no-preference"),n.useEffect(function(){var e=function(e){ge.current=e.matches};return null==me||me.addListener(e),function(){return null==me?void 0:me.removeListener(e)}},[me]),ge),Ne=function(e){var t=e.targetRef,r=e.enabled,o=e.reserveScrollBarGap,i=e.ignoreLockClasses,a=n.useRef({activate:function(){throw new TypeError("Tried to activate scroll lock too early")},deactivate:function(){}});return n.useDebugValue(r?"Enabled":"Disabled"),n.useEffect(function(){if(!r)return a.current.deactivate(),void(a.current={activate:function(){},deactivate:function(){}});var e=t.current,n=!1;a.current={activate:function(){var t,r;n||(n=!0,y?(S.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),E&&(document.removeEventListener("touchmove",R,p?{passive:!1}:void 0),E=!1),b=-1):C(),S=[],r={allowTouchMove:function(e){return 0!==i.length&&i.some(function(n){return n&&n.length&&e.closest("."+n)})},reserveScrollBarGap:o},(t=e)&&(S.some(function(e){return e.targetElement===t})||(S=[].concat(S,[{targetElement:t,options:r||{}}]),y?(t.ontouchstart=function(e){1===e.targetTouches.length&&(b=e.targetTouches[0].clientY)},t.ontouchmove=function(e){1===e.targetTouches.length&&function(e,n){var t=e.targetTouches[0].clientY-b;(!P(e.target)||!(0!==n.scrollTop&&t>0||!w(n)&&t<0))&&(n&&0===n.scrollTop&&t>0||w(n)&&t<0?R(e):e.stopPropagation())}(e,t)},E||(document.addEventListener("touchmove",R,p?{passive:!1}:void 0),E=!0)):function(e){if(void 0===h){var n=window.innerWidth-document.documentElement.clientWidth;if(e&&!0===e.reserveScrollBarGap&&n>0){var t=parseInt(getComputedStyle(document.body).getPropertyValue("padding-right"),10);h=document.body.style.paddingRight,document.body.style.paddingRight=t+n+"px"}}void 0===g&&(g=document.body.style.overflow,document.body.style.overflow="hidden")}(r))))},deactivate:function(){var t;n&&(n=!1,(t=e)&&(S=S.filter(function(e){return e.targetElement!==t}),y?(t.ontouchstart=null,t.ontouchmove=null,E&&0===S.length&&(document.removeEventListener("touchmove",R,p?{passive:!1}:void 0),E=!1)):S.length||C()))}}},[r,t,o,i]),a}({targetRef:be,enabled:se&&$,reserveScrollBarGap:oe,ignoreLockClasses:N?Array.isArray(N)?N:[N]:[]}),He=function(e){var t=e.targetRef,r=e.enabled,o=n.useRef({activate:function(){throw new TypeError("Tried to activate aria hider too early")},deactivate:function(){}});return n.useDebugValue(r?"Enabled":"Disabled"),n.useEffect(function(){if(!r)return o.current.deactivate(),void(o.current={activate:function(){},deactivate:function(){}});var e=t.current,n=!1,i=[],a=[];o.current={activate:function(){if(!n){n=!0;var t=e.parentNode;document.querySelectorAll("body > *").forEach(function(e){if(e!==t){var n=e.getAttribute("aria-hidden");null!==n&&"false"!==n||(i.push(n),a.push(e),e.setAttribute("aria-hidden","true"))}})}},deactivate:function(){n&&(n=!1,a.forEach(function(e,n){var t=i[n];null===t?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",t)}),i=[],a=[])}}},[t,r]),o}({targetRef:Ee,enabled:se&&U}),je=function(e){var t=e.targetRef,r=e.fallbackRef,o=e.initialFocusRef,a=e.enabled,c=n.useRef({activate:function(){throw new TypeError("Tried to activate focus trap too early")},deactivate:function(){}});return n.useDebugValue(a?"Enabled":"Disabled"),n.useEffect(function(){if(!a)return c.current.deactivate(),void(c.current={activate:function(){},deactivate:function(){}});var e=r.current,n=i.createFocusTrap(t.current,{onActivate:void 0,initialFocus:o?function(){return(null==o?void 0:o.current)||e}:void 0,fallbackFocus:e,escapeDeactivates:!1,clickOutsideDeactivates:!1}),u=!1;c.current={activate:function(){try{return u?Promise.resolve():(u=!0,Promise.resolve(n.activate()).then(function(){return Promise.resolve(new Promise(function(e){return setTimeout(function(){return e(void 0)},0)})).then(function(){})}))}catch(e){return Promise.reject(e)}},deactivate:function(){u&&(u=!1,n.deactivate())}}},[a,r,o,t]),c}({targetRef:Ee,fallbackRef:we,initialFocusRef:q||void 0,enabled:se&&U&&!1!==q}),ze=function(e){var t=e.getSnapPoints,r=e.heightRef,o=e.lastSnapRef,i=e.ready,a=function(e){var t=e.contentRef,r=e.controlledMaxHeight,o=e.footerEnabled,i=e.footerRef,a=e.headerEnabled,c=e.headerRef,u=e.registerReady,s=e.resizeSourceRef,l=n.useMemo(function(){return u("contentHeight")},[u]),f=function(e,t,r){var o=n.useMemo(function(){return t("maxHeight")},[t]),i=n.useState(function(){return k(e)||"undefined"!=typeof window?window.innerHeight:0}),a=i[0],c=i[1],u=a>0,s=n.useRef(0);return n.useDebugValue(e?"controlled":"auto"),n.useEffect(function(){u&&o()},[u,o]),v(function(){if(e)return c(k(e)),void(r.current="maxheightprop");var n=function(){s.current||(s.current=requestAnimationFrame(function(){c(window.innerHeight),r.current="window",s.current=0}))};return window.addEventListener("resize",n),c(window.innerHeight),r.current="window",o(),function(){window.removeEventListener("resize",n),cancelAnimationFrame(s.current)}},[e,o,r]),a}(r,u,s),d=D(c,{label:"headerHeight",enabled:a,resizeSourceRef:s}),p=D(t,{label:"contentHeight",enabled:!0,resizeSourceRef:s}),m=D(i,{label:"footerHeight",enabled:o,resizeSourceRef:s}),g=Math.min(f-d-m,p)+d+m;n.useDebugValue("minHeight: "+g);var h=p>0;return n.useEffect(function(){h&&l()},[h,l]),{maxHeight:f,minHeight:g,headerHeight:d,footerHeight:m}}({contentRef:e.contentRef,controlledMaxHeight:e.controlledMaxHeight,footerEnabled:e.footerEnabled,footerRef:e.footerRef,headerEnabled:e.headerEnabled,headerRef:e.headerRef,registerReady:e.registerReady,resizeSourceRef:e.resizeSourceRef}),c=a.maxHeight,u=a.minHeight,s=a.headerHeight,l=a.footerHeight,f=function(e,n){var t=[].concat(e).map(k).reduce(function(e,t){return e.add(O(t,0,n)),e},new Set),r=Array.from(t),o=Math.min.apply(Math,r);if(Number.isNaN(o))throw new TypeError("minSnap is NaN");var i=Math.max.apply(Math,r);if(Number.isNaN(i))throw new TypeError("maxSnap is NaN");return{snapPoints:r,minSnap:o,maxSnap:i}}(i?t({height:r.current,footerHeight:l,headerHeight:s,minHeight:u,maxHeight:c}):[0],c),d=f.snapPoints,p=f.minSnap,m=f.maxSnap;return n.useDebugValue("minSnap: "+p+", maxSnap:"+m),{minSnap:p,maxSnap:m,findSnap:function(e){var n=k("function"==typeof e?e({footerHeight:l,headerHeight:s,height:r.current,minHeight:u,maxHeight:c,snapPoints:d,lastSnap:o.current}):e);return d.reduce(function(e,t){return Math.abs(t-n)<Math.abs(e-n)?t:e},p)},maxHeight:c}}({contentRef:Pe,controlledMaxHeight:Z,footerEnabled:!!H,footerRef:Ce,getSnapPoints:J,headerEnabled:!1!==j,headerRef:Re,heightRef:Oe,lastSnapRef:V,ready:se,registerReady:le,resizeSourceRef:ke}),Le=ze.minSnap,Te=ze.maxSnap,Ae=ze.maxHeight,Me=ze.findSnap,Ie=n.useRef(Ae),Fe=n.useRef(Le),Ge=n.useRef(Te),Ve=n.useRef(Me),qe=n.useRef(0),Be=n.useRef(m||0);v(function(){Ie.current=Ae,Ge.current=Te,Fe.current=Le,Ve.current=Me,qe.current=Me(Y)},[Me,Y,Ae,Te,Le]);var Ze=n.useCallback(function(e){var n=e.onRest,t=e.config,r=(t=void 0===t?{}:t).velocity,o=void 0===r?1:r,i=d(t,["velocity"]),a=d(e,["onRest","config"]);return new Promise(function(e){return Se(f({},a,{config:f({velocity:o},i,{mass:1,tension:T,friction:Math.max(A,A+(A-A*o))},x),onRest:function(){var t=[].slice.call(arguments);e.apply(void 0,t),null==n||n.apply(void 0,t)}}))})},[Se]),We=t.useMachine(z,{devTools:!1,actions:{onOpenCancel:n.useCallback(function(){return null==ve.current?void 0:ve.current({type:"OPEN"})},[]),onSnapCancel:n.useCallback(function(e){return null==ve.current?void 0:ve.current({type:"SNAP",source:e.snapSource})},[]),onCloseCancel:n.useCallback(function(){return null==ve.current?void 0:ve.current({type:"CLOSE"})},[]),onResizeCancel:n.useCallback(function(){return null==ve.current?void 0:ve.current({type:"RESIZE",source:ke.current})},[]),onOpenEnd:n.useCallback(function(){return null==pe.current?void 0:pe.current({type:"OPEN"})},[]),onSnapEnd:n.useCallback(function(e,n){return null==pe.current?void 0:pe.current({type:"SNAP",source:e.snapSource})},[]),onResizeEnd:n.useCallback(function(){return null==pe.current?void 0:pe.current({type:"RESIZE",source:ke.current})},[])},context:{initialState:M},services:{onSnapStart:n.useCallback(function(e,n){try{return Promise.resolve(null==de.current?void 0:de.current({type:"SNAP",source:n.payload.source||"custom"}))}catch(e){return Promise.reject(e)}},[]),onOpenStart:n.useCallback(function(){try{return Promise.resolve(null==de.current?void 0:de.current({type:"OPEN"}))}catch(e){return Promise.reject(e)}},[]),onCloseStart:n.useCallback(function(){try{return Promise.resolve(null==de.current?void 0:de.current({type:"CLOSE"}))}catch(e){return Promise.reject(e)}},[]),onResizeStart:n.useCallback(function(){try{return Promise.resolve(null==de.current?void 0:de.current({type:"RESIZE",source:ke.current}))}catch(e){return Promise.reject(e)}},[]),onSnapEnd:n.useCallback(function(e,n){try{return Promise.resolve(null==pe.current?void 0:pe.current({type:"SNAP",source:e.snapSource}))}catch(e){return Promise.reject(e)}},[]),onOpenEnd:n.useCallback(function(){try{return Promise.resolve(null==pe.current?void 0:pe.current({type:"OPEN"}))}catch(e){return Promise.reject(e)}},[]),onCloseEnd:n.useCallback(function(){try{return Promise.resolve(null==pe.current?void 0:pe.current({type:"CLOSE"}))}catch(e){return Promise.reject(e)}},[]),onResizeEnd:n.useCallback(function(){try{return Promise.resolve(null==pe.current?void 0:pe.current({type:"RESIZE",source:ke.current}))}catch(e){return Promise.reject(e)}},[]),renderVisuallyHidden:n.useCallback(function(e,n){try{return Promise.resolve(Ze({y:qe.current,ready:0,maxHeight:Ie.current,maxSnap:Ge.current,minSnap:qe.current,immediate:!0,topOffset:Be.current})).then(function(){})}catch(e){return Promise.reject(e)}},[Ze]),activate:n.useCallback(function(e,n){try{return fe.current=!0,Promise.resolve(Promise.all([Ne.current.activate(),je.current.activate(),He.current.activate()])).then(function(){})}catch(e){return Promise.reject(e)}},[He,je,Ne]),deactivate:n.useCallback(function(){try{return Ne.current.deactivate(),je.current.deactivate(),He.current.deactivate(),fe.current=!1,Promise.resolve()}catch(e){return Promise.reject(e)}},[He,je,Ne]),openImmediately:n.useCallback(function(){try{return Oe.current=qe.current,Promise.resolve(Ze({y:qe.current,ready:1,maxHeight:Ie.current,maxSnap:Ge.current,minSnap:qe.current,immediate:!0,topOffset:Be.current})).then(function(){})}catch(e){return Promise.reject(e)}},[Ze]),openSmoothly:n.useCallback(function(){try{return Promise.resolve(Ze({y:0,ready:1,maxHeight:Ie.current,maxSnap:Ge.current,minSnap:qe.current,immediate:!0,topOffset:Be.current})).then(function(){return Oe.current=qe.current,Promise.resolve(Ze({y:qe.current,ready:1,maxHeight:Ie.current,maxSnap:Ge.current,minSnap:qe.current,immediate:De.current,topOffset:Be.current})).then(function(){})})}catch(e){return Promise.reject(e)}},[Ze,De]),snapSmoothly:n.useCallback(function(e,n){try{var t=Ve.current(e.y);return Oe.current=t,V.current=t,Promise.resolve(Ze({y:t,ready:1,maxHeight:Ie.current,maxSnap:Ge.current,minSnap:Fe.current,immediate:De.current,topOffset:Be.current,config:{velocity:e.velocity}})).then(function(){})}catch(e){return Promise.reject(e)}},[Ze,V,De]),resizeSmoothly:n.useCallback(function(){try{var e=Ve.current(Oe.current);return Oe.current=e,V.current=e,Promise.resolve(Ze({y:e,ready:1,maxHeight:Ie.current,maxSnap:Ge.current,minSnap:Fe.current,topOffset:Be.current,immediate:"element"!==ke.current||De.current})).then(function(){})}catch(e){return Promise.reject(e)}},[Ze,V,De]),closeSmoothly:n.useCallback(function(e,n){try{return Ze({minSnap:Oe.current,immediate:!0}),Oe.current=0,Promise.resolve(Ze({y:0,maxHeight:Ie.current,maxSnap:Ge.current,immediate:De.current})).then(function(){return Promise.resolve(Ze({ready:0,immediate:!0})).then(function(){})})}catch(e){return Promise.reject(e)}},[Ze,De])}}),Ye=We[0],Ke=We[1];n.useEffect(function(){se&&Ke(L?"OPEN":"CLOSE")},[L,Ke,se]),v(function(){(Ae||Te||Le)&&Ke("RESIZE")},[Ae,Te,Le,Ke]),n.useEffect(function(){return function(){Ne.current.deactivate(),je.current.deactivate(),He.current.deactivate()}},[He,je,Ne]),n.useImperativeHandle(a,function(){return{snapTo:function(e,n){var t=void 0===n?{}:n,r=t.velocity,o=void 0===r?1:r,i=t.source,a=void 0===i?"custom":i;Ke("SNAP",{payload:{y:Ve.current(e),velocity:o,source:a}})},get height(){return Oe.current}}},[Ke]),n.useEffect(function(){var e=be.current,n=function(e){xe.current&&e.preventDefault()},t=function(n){e.scrollTop<0&&(requestAnimationFrame(function(){e.style.overflow="hidden",e.scrollTop=0,e.style.removeProperty("overflow")}),n.preventDefault())};return ae&&(e.addEventListener("scroll",n),e.addEventListener("touchmove",n),e.addEventListener("touchstart",t)),function(){e.removeEventListener("scroll",n),e.removeEventListener("touchmove",n),e.removeEventListener("touchstart",t)}},[ae,be]);var Je=o.useDrag(function(e){var n=e.args,t=(n=void 0===n?[]:n)[0],r=(t=void 0===t?{}:t).closeOnTap,i=void 0!==r&&r,a=t.isContentDragging,c=void 0!==a&&a,u=e.cancel,s=e.direction[1],l=e.down,f=e.first,d=e.last,v=e.memo,p=void 0===v?ye.y.getValue():v,m=e.tap,g=e.velocity,h=-1*e.movement[1];if(!fe.current)return u(),p;if(B&&i&&m)return u(),setTimeout(function(){return B()},0),p;if(m)return p;var y=p+h,S=h*g,E=Math.max(Fe.current,Math.min(Ge.current,y+2*S));if(!l&&B&&s>0&&y+S<Fe.current/2)return u(),B(),p;var b=l?B||Fe.current!==Ge.current?o.rubberbandIfOutOfBounds(y,B?0:Fe.current,Ge.current,.85):y<Fe.current?o.rubberbandIfOutOfBounds(y,Fe.current,2*Ge.current,.85):o.rubberbandIfOutOfBounds(y,Fe.current/2,Ge.current,.85):E;return ae&&c?(b>=Ge.current&&(b=Ge.current),p===Ge.current&&be.current.scrollTop>0&&(b=Ge.current),xe.current=b<Ge.current):xe.current=!1,f&&Ke("DRAG"),d?(Ke("SNAP",{payload:{y:b,velocity:g>.05?g:1,source:"dragging"}}),p):(Se({y:b,ready:1,maxHeight:Ie.current,maxSnap:Ge.current,minSnap:Fe.current,topOffset:Be.current,immediate:!0,config:{velocity:g}}),p)},{filterTaps:!0});if(Number.isNaN(Ge.current))throw new TypeError("maxSnapRef is NaN!!");if(Number.isNaN(Fe.current))throw new TypeError("minSnapRef is NaN!!");var Qe=function(e){var n,t=e.spring,o=r.interpolate([t.y,t.maxHeight,t.topOffset],function(e,n,t){return Math.round(O(n-e-(t||0),0,16))+"px"}),i=r.interpolate([t.y,t.minSnap,t.maxSnap],function(e,n,t){return O(e,n,t)+"px"}),a=r.interpolate([t.y,t.minSnap,t.maxSnap],function(e,n,t){return e<n?n-e+"px":e>t?t-e+"px":"0px"}),c=r.interpolate([t.y,t.maxSnap],function(e,n){return e>=n?Math.ceil(e-n):0}),u=r.interpolate([t.y,t.minSnap],function(e,n){if(!n)return 0;var t=Math.max(n/2-45,0);return O((e-t)*(1/(Math.min(n/2+45,n)-t)+0),0,1)}),s=r.interpolate([t.y,t.minSnap],function(e,n){return n?O(e/n,0,1):0});return(n={})["--rsbs-content-opacity"]=u,n["--rsbs-backdrop-opacity"]=s,n["--rsbs-antigap-scale-y"]=c,n["--rsbs-overlay-translate-y"]=a,n["--rsbs-overlay-rounded"]=o,n["--rsbs-overlay-h"]=i,n}({spring:ye});return l.default.createElement(r.animated.div,f({},ce,{"data-rsbs-root":!0,"data-rsbs-state":I.find(Ye.matches),"data-rsbs-is-blocking":U,"data-rsbs-is-dismissable":!!B,"data-rsbs-has-header":!!j,"data-rsbs-has-footer":!!H,className:s,ref:Ee,style:f({},Qe,_,{opacity:ye.ready})}),u,U&&l.default.createElement("div",f({key:"backdrop","data-rsbs-backdrop":!0},Je({closeOnTap:!0}))),l.default.createElement("div",{key:"overlay","aria-modal":"true",role:"dialog","data-rsbs-overlay":!0,tabIndex:-1,ref:we,onKeyDown:function(e){"Escape"===e.key&&(e.stopPropagation(),B&&B())}},!1!==j&&l.default.createElement("div",f({key:"header","data-rsbs-header":!0,ref:Re},Je()),j),l.default.createElement("div",f({key:"scroll","data-rsbs-scroll":!0,ref:be},ae?Je({isContentDragging:!0}):{}),l.default.createElement("div",{"data-rsbs-content":!0,ref:Pe},c||l.default.createElement("div",{style:{position:"relative",height:"1000",overflow:"hidden"}}))),H&&l.default.createElement("div",f({key:"footer",ref:Ce,"data-rsbs-footer":!0},Je()),H)))}),I=["closed","opening","open","closing","dragging","snapping","resizing"];function F(e){var n=e.lastSnap;return null!=n?n:Math.min.apply(Math,e.snapPoints)}function G(e){return e.minHeight}var V=n.forwardRef(function(e,t){var r=e.onSpringStart,o=e.onSpringEnd,i=e.skipInitialTransition,a=d(e,["onSpringStart","onSpringEnd","skipInitialTransition"]),c=n.useState(!1),u=c[0],p=c[1],m=n.useRef(),g=n.useRef(null),h=n.useRef(i&&a.open?"OPEN":"CLOSED");v(function(){if(a.open)return cancelAnimationFrame(m.current),p(!0),function(){h.current="CLOSED"}},[a.open]);var y=n.useCallback(function(e){try{return Promise.resolve(null==r?void 0:r(e)).then(function(){"OPEN"===e.type&&cancelAnimationFrame(m.current)})}catch(e){return Promise.reject(e)}},[r]),S=n.useCallback(function(e){try{return Promise.resolve(null==o?void 0:o(e)).then(function(){"CLOSE"===e.type&&(m.current=requestAnimationFrame(function(){return p(!1)}))})}catch(e){return Promise.reject(e)}},[o]);return u?l.default.createElement(s.default,{"data-rsbs-portal":!0},l.default.createElement(M,f({},a,{lastSnapRef:g,ref:t,initialState:h.current,onSpringStart:y,onSpringEnd:S}))):null});exports.BottomSheet=V;
//# sourceMappingURL=index.js.map
