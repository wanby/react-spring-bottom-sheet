import e from"@reach/portal";import n,{useRef as t,useDebugValue as r,useEffect as o,useLayoutEffect as i,useState as a,useCallback as c,useMemo as u,useImperativeHandle as s,forwardRef as l}from"react";import{useMachine as d}from"@xstate/react";import{useSpring as f,interpolate as v,animated as m,config as p}from"react-spring";import{useDrag as h,rubberbandIfOutOfBounds as g}from"react-use-gesture";import{createFocusTrap as y}from"focus-trap";import{ResizeObserver as S}from"@juggle/resize-observer";import{Machine as E,assign as P}from"xstate";function b(){return(b=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function R(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n.indexOf(t=i[r])>=0||(o[t]=e[t]);return o}var w="undefined"!=typeof window?i:o,O=!1;if("undefined"!=typeof window){var x={get passive(){O=!0}};window.addEventListener("testPassive",null,x),window.removeEventListener("testPassive",null,x)}var C,N,H="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),D=[],k=!1,j=-1,z=function(e){return D.some(function(n){return!(!n.options.allowTouchMove||!n.options.allowTouchMove(e))})},L=function(e){var n=e||window.event;return!!z(n.target)||n.touches.length>1||(n.preventDefault&&n.preventDefault(),!1)},T=function(){void 0!==N&&(document.body.style.paddingRight=N,N=void 0),void 0!==C&&(document.body.style.overflow=C,C=void 0)},A=function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight};function M(e,n,t){return n=(n=+n)==n?n:0,t=(t=+t)==t?t:0,(e=+e)==e&&(e=(e=e<=t?e:t)>=n?e:n),e}function I(e){var n=Math.round(e);if(Number.isNaN(e))throw new TypeError("Found a NaN! Check your snapPoints / defaultSnap / snapTo ");return n}var G={box:"border-box"};function F(e,n){var t=n.label,o=n.enabled,i=n.resizeSourceRef,u=a(0),s=u[0],l=u[1];r(t+": "+s);var d=c(function(e){l(e[0].borderBoxSize[0].blockSize),i.current="element"},[i]);return w(function(){if(e.current&&o){var n=new S(d);return n.observe(e.current,G),function(){n.disconnect()}}},[e,d,o]),o?s:0}function Z(e){return void 0===e&&(e=1e3),new Promise(function(n){return setTimeout(n,e)})}var B={DRAG:{target:"#overlay.dragging",actions:"onOpenEnd"}},V={RESIZE:{target:"#overlay.resizing",actions:"onOpenEnd"}},q=E({id:"overlay",initial:"closed",context:{initialState:"CLOSED"},states:{closed:{on:{OPEN:"opening",CLOSE:void 0}},opening:{initial:"start",states:{start:{invoke:{src:"onOpenStart",onDone:"transition"}},transition:{always:[{target:"immediately",cond:"initiallyOpen"},{target:"smoothly",cond:"initiallyClosed"}]},immediately:{initial:"open",states:{open:{invoke:{src:"openImmediately",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"#overlay.opening.end"},on:b({},B,V)}}},smoothly:{initial:"visuallyHidden",states:{visuallyHidden:{invoke:{src:"renderVisuallyHidden",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"open"}},open:{invoke:{src:"openSmoothly",onDone:"#overlay.opening.end"},on:b({},B,V)}}},end:{invoke:{src:"onOpenEnd",onDone:"done"},on:{CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:b({},{CLOSE:{target:"#overlay.closing",actions:"onOpenCancel"}}),onDone:"open"},open:{on:{DRAG:"#overlay.dragging",SNAP:"snapping",RESIZE:"resizing"}},dragging:{on:{SNAP:"snapping"}},snapping:{initial:"start",states:{start:{invoke:{src:"onSnapStart",onDone:"snappingSmoothly"},entry:[P({y:function(e,n){return n.payload.y},velocity:function(e,n){return n.payload.velocity},snapSource:function(e,n){var t=n.payload.source;return void 0===t?"custom":t}})]},snappingSmoothly:{invoke:{src:"snapSmoothly",onDone:"end"}},end:{invoke:{src:"onSnapEnd",onDone:"done"},on:{RESIZE:"#overlay.resizing",SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{SNAP:{target:"snapping",actions:"onSnapEnd"},RESIZE:{target:"#overlay.resizing",actions:"onSnapCancel"},DRAG:{target:"#overlay.dragging",actions:"onSnapCancel"},CLOSE:{target:"#overlay.closing",actions:"onSnapCancel"}},onDone:"open"},resizing:{initial:"start",states:{start:{invoke:{src:"onResizeStart",onDone:"resizingSmoothly"}},resizingSmoothly:{invoke:{src:"resizeSmoothly",onDone:"end"}},end:{invoke:{src:"onResizeEnd",onDone:"done"},on:{SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{RESIZE:{target:"resizing",actions:"onResizeEnd"},SNAP:{target:"snapping",actions:"onResizeCancel"},DRAG:{target:"#overlay.dragging",actions:"onResizeCancel"},CLOSE:{target:"#overlay.closing",actions:"onResizeCancel"}},onDone:"open"},closing:{initial:"start",states:{start:{invoke:{src:"onCloseStart",onDone:"deactivating"},on:{OPEN:{target:"#overlay.open",actions:"onCloseCancel"}}},deactivating:{invoke:{src:"deactivate",onDone:"closingSmoothly"}},closingSmoothly:{invoke:{src:"closeSmoothly",onDone:"end"}},end:{invoke:{src:"onCloseEnd",onDone:"done"},on:{OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}}},done:{type:"final"}},on:{CLOSE:void 0,OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}},onDone:"closed"}},on:{CLOSE:"closing"}},{actions:{onOpenCancel:function(e,n){},onSnapCancel:function(e,n){},onResizeCancel:function(e,n){},onCloseCancel:function(e,n){},onOpenEnd:function(e,n){},onSnapEnd:function(e,n){},onRezizeEnd:function(e,n){}},services:{onSnapStart:function(){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},onOpenStart:function(){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},onCloseStart:function(){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},onResizeStart:function(){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},onSnapEnd:function(){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},onOpenEnd:function(){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},onCloseEnd:function(){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},onResizeEnd:function(){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},renderVisuallyHidden:function(e,n){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},activate:function(e,n){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},deactivate:function(e,n){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},openSmoothly:function(e,n){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},openImmediately:function(e,n){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},snapSmoothly:function(e,n){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},resizeSmoothly:function(e,n){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}},closeSmoothly:function(e,n){try{return Promise.resolve(Z()).then(function(){})}catch(e){return Promise.reject(e)}}},guards:{initiallyClosed:function(e){return"CLOSED"===e.initialState},initiallyOpen:function(e){return"OPEN"===e.initialState}}}),W=p.default,Y=W.tension,K=W.friction,J=n.forwardRef(function(e,i){var l=e.children,p=e.sibling,S=e.className,E=e.topOffset,P=e.springConfig,x=e.ignoreLockClasses,G=e.footer,Z=e.header,B=e.open,V=e.initialState,W=e.lastSnapRef,J=e.initialFocusRef,$=e.onDismiss,_=e.maxHeight,ee=e.defaultSnap,ne=void 0===ee?U:ee,te=e.snapPoints,re=void 0===te?X:te,oe=e.blocking,ie=void 0===oe||oe,ae=e.scrollLocking,ce=void 0===ae||ae,ue=e.style,se=e.onSpringStart,le=e.onSpringCancel,de=e.onSpringEnd,fe=e.reserveScrollBarGap,ve=void 0===fe?ie:fe,me=e.expandOnContentDrag,pe=void 0!==me&&me,he=R(e,["children","sibling","className","topOffset","springConfig","ignoreLockClasses","footer","header","open","initialState","lastSnapRef","initialFocusRef","onDismiss","maxHeight","defaultSnap","snapPoints","blocking","scrollLocking","style","onSpringStart","onSpringCancel","onSpringEnd","reserveScrollBarGap","expandOnContentDrag"]),ge=function(){var e=a(!1),n=e[0],t=e[1],r=a({}),i=r[0],u=r[1],s=c(function(e){return u(function(n){var t;return b({},n,((t={})[e]=!1,t))}),function(){u(function(n){var t;return b({},n,((t={})[e]=!0,t))})}},[]);return o(function(){var e=Object.values(i);0!==e.length&&e.every(Boolean)&&t(!0)},[i]),{ready:n,registerReady:s}}(),ye=ge.ready,Se=ge.registerReady,Ee=t(!1),Pe=t(se),be=t(le),Re=t(de);o(function(){Pe.current=se,be.current=le,Re.current=de},[le,se,de]);var we,Oe,xe=f(function(){return{y:0,ready:0,maxHeight:0,minSnap:0,maxSnap:0,topOffset:0}}),Ce=xe[0],Ne=xe[1],He=t(null),De=t(null),ke=t(null),je=t(null),ze=t(null),Le=t(null),Te=t(0),Ae=t(),Me=t(!1),Ie=(we=u(function(){return"undefined"!=typeof window?window.matchMedia("(prefers-reduced-motion: reduce)"):null},[]),Oe=t(null==we?void 0:we.matches),r(Oe.current?"reduce":"no-preference"),o(function(){var e=function(e){Oe.current=e.matches};return null==we||we.addListener(e),function(){return null==we?void 0:we.removeListener(e)}},[we]),Oe),Ge=function(e){var n=e.targetRef,i=e.enabled,a=e.reserveScrollBarGap,c=e.ignoreLockClasses,u=t({activate:function(){throw new TypeError("Tried to activate scroll lock too early")},deactivate:function(){}});return r(i?"Enabled":"Disabled"),o(function(){if(!i)return u.current.deactivate(),void(u.current={activate:function(){},deactivate:function(){}});var e=n.current,t=!1;u.current={activate:function(){var n,r;t||(t=!0,H?(D.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),k&&(document.removeEventListener("touchmove",L,O?{passive:!1}:void 0),k=!1),j=-1):T(),D=[],r={allowTouchMove:function(e){return 0!==c.length&&c.some(function(n){return n&&n.length&&e.closest("."+n)})},reserveScrollBarGap:a},(n=e)&&(D.some(function(e){return e.targetElement===n})||(D=[].concat(D,[{targetElement:n,options:r||{}}]),H?(n.ontouchstart=function(e){1===e.targetTouches.length&&(j=e.targetTouches[0].clientY)},n.ontouchmove=function(e){1===e.targetTouches.length&&function(e,n){var t=e.targetTouches[0].clientY-j;(!z(e.target)||!(0!==n.scrollTop&&t>0||!A(n)&&t<0))&&(n&&0===n.scrollTop&&t>0||A(n)&&t<0?L(e):e.stopPropagation())}(e,n)},k||(document.addEventListener("touchmove",L,O?{passive:!1}:void 0),k=!0)):function(e){if(void 0===N){var n=window.innerWidth-document.documentElement.clientWidth;if(e&&!0===e.reserveScrollBarGap&&n>0){var t=parseInt(getComputedStyle(document.body).getPropertyValue("padding-right"),10);N=document.body.style.paddingRight,document.body.style.paddingRight=t+n+"px"}}void 0===C&&(C=document.body.style.overflow,document.body.style.overflow="hidden")}(r))))},deactivate:function(){var n;t&&(t=!1,(n=e)&&(D=D.filter(function(e){return e.targetElement!==n}),H?(n.ontouchstart=null,n.ontouchmove=null,k&&0===D.length&&(document.removeEventListener("touchmove",L,O?{passive:!1}:void 0),k=!1)):D.length||T()))}}},[i,n,a,c]),u}({targetRef:De,enabled:ye&&ce,reserveScrollBarGap:ve,ignoreLockClasses:x?Array.isArray(x)?x:[x]:[]}),Fe=function(e){var n=e.targetRef,i=e.enabled,a=t({activate:function(){throw new TypeError("Tried to activate aria hider too early")},deactivate:function(){}});return r(i?"Enabled":"Disabled"),o(function(){if(!i)return a.current.deactivate(),void(a.current={activate:function(){},deactivate:function(){}});var e=n.current,t=!1,r=[],o=[];a.current={activate:function(){if(!t){t=!0;var n=e.parentNode;document.querySelectorAll("body > *").forEach(function(e){if(e!==n){var t=e.getAttribute("aria-hidden");null!==t&&"false"!==t||(r.push(t),o.push(e),e.setAttribute("aria-hidden","true"))}})}},deactivate:function(){t&&(t=!1,o.forEach(function(e,n){var t=r[n];null===t?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",t)}),r=[],o=[])}}},[n,i]),a}({targetRef:He,enabled:ye&&ie}),Ze=function(e){var n=e.targetRef,i=e.fallbackRef,a=e.initialFocusRef,c=e.enabled,u=t({activate:function(){throw new TypeError("Tried to activate focus trap too early")},deactivate:function(){}});return r(c?"Enabled":"Disabled"),o(function(){if(!c)return u.current.deactivate(),void(u.current={activate:function(){},deactivate:function(){}});var e=i.current,t=y(n.current,{onActivate:void 0,initialFocus:a?function(){return(null==a?void 0:a.current)||e}:void 0,fallbackFocus:e,escapeDeactivates:!1,clickOutsideDeactivates:!1}),r=!1;u.current={activate:function(){try{return r?Promise.resolve():(r=!0,Promise.resolve(t.activate()).then(function(){return Promise.resolve(new Promise(function(e){return setTimeout(function(){return e(void 0)},0)})).then(function(){})}))}catch(e){return Promise.reject(e)}},deactivate:function(){r&&(r=!1,t.deactivate())}}},[c,i,a,n]),u}({targetRef:He,fallbackRef:Le,initialFocusRef:J||void 0,enabled:ye&&ie&&!1!==J}),Be=function(e){var n=e.getSnapPoints,i=e.heightRef,c=e.lastSnapRef,s=e.ready,l=function(e){var n=e.contentRef,i=e.controlledMaxHeight,c=e.footerEnabled,s=e.footerRef,l=e.headerEnabled,d=e.headerRef,f=e.registerReady,v=e.resizeSourceRef,m=u(function(){return f("contentHeight")},[f]),p=function(e,n,i){var c=u(function(){return n("maxHeight")},[n]),s=a(function(){return I(e)||"undefined"!=typeof window?window.innerHeight:0}),l=s[0],d=s[1],f=l>0,v=t(0);return r(e?"controlled":"auto"),o(function(){f&&c()},[f,c]),w(function(){if(e)return d(I(e)),void(i.current="maxheightprop");var n=function(){v.current||(v.current=requestAnimationFrame(function(){d(window.innerHeight),i.current="window",v.current=0}))};return window.addEventListener("resize",n),d(window.innerHeight),i.current="window",c(),function(){window.removeEventListener("resize",n),cancelAnimationFrame(v.current)}},[e,c,i]),l}(i,f,v),h=F(d,{label:"headerHeight",enabled:l,resizeSourceRef:v}),g=F(n,{label:"contentHeight",enabled:!0,resizeSourceRef:v}),y=F(s,{label:"footerHeight",enabled:c,resizeSourceRef:v}),S=Math.min(p-h-y,g)+h+y;r("minHeight: "+S);var E=g>0;return o(function(){E&&m()},[E,m]),{maxHeight:p,minHeight:S,headerHeight:h,footerHeight:y}}({contentRef:e.contentRef,controlledMaxHeight:e.controlledMaxHeight,footerEnabled:e.footerEnabled,footerRef:e.footerRef,headerEnabled:e.headerEnabled,headerRef:e.headerRef,registerReady:e.registerReady,resizeSourceRef:e.resizeSourceRef}),d=l.maxHeight,f=l.minHeight,v=l.headerHeight,m=l.footerHeight,p=function(e,n){var t=[].concat(e).map(I).reduce(function(e,t){return e.add(M(t,0,n)),e},new Set),r=Array.from(t),o=Math.min.apply(Math,r);if(Number.isNaN(o))throw new TypeError("minSnap is NaN");var i=Math.max.apply(Math,r);if(Number.isNaN(i))throw new TypeError("maxSnap is NaN");return{snapPoints:r,minSnap:o,maxSnap:i}}(s?n({height:i.current,footerHeight:m,headerHeight:v,minHeight:f,maxHeight:d}):[0],d),h=p.snapPoints,g=p.minSnap,y=p.maxSnap;return r("minSnap: "+g+", maxSnap:"+y),{minSnap:g,maxSnap:y,findSnap:function(e){var n=I("function"==typeof e?e({footerHeight:m,headerHeight:v,height:i.current,minHeight:f,maxHeight:d,snapPoints:h,lastSnap:c.current}):e);return h.reduce(function(e,t){return Math.abs(t-n)<Math.abs(e-n)?t:e},g)},maxHeight:d}}({contentRef:ke,controlledMaxHeight:_,footerEnabled:!!G,footerRef:ze,getSnapPoints:re,headerEnabled:!1!==Z,headerRef:je,heightRef:Te,lastSnapRef:W,ready:ye,registerReady:Se,resizeSourceRef:Ae}),Ve=Be.minSnap,qe=Be.maxSnap,We=Be.maxHeight,Ye=Be.findSnap,Ke=t(We),Je=t(Ve),Qe=t(qe),Ue=t(Ye),Xe=t(0),$e=t(E||0);w(function(){Ke.current=We,Qe.current=qe,Je.current=Ve,Ue.current=Ye,Xe.current=Ye(ne)},[Ye,ne,We,qe,Ve]);var _e=c(function(e){var n=e.onRest,t=e.config,r=(t=void 0===t?{}:t).velocity,o=void 0===r?1:r,i=R(t,["velocity"]),a=R(e,["onRest","config"]);return new Promise(function(e){return Ne(b({},a,{config:b({velocity:o},i,{mass:1,tension:Y,friction:Math.max(K,K+(K-K*o))},P),onRest:function(){var t=[].slice.call(arguments);e.apply(void 0,t),null==n||n.apply(void 0,t)}}))})},[Ne]),en=d(q,{devTools:!1,actions:{onOpenCancel:c(function(){return null==be.current?void 0:be.current({type:"OPEN"})},[]),onSnapCancel:c(function(e){return null==be.current?void 0:be.current({type:"SNAP",source:e.snapSource})},[]),onCloseCancel:c(function(){return null==be.current?void 0:be.current({type:"CLOSE"})},[]),onResizeCancel:c(function(){return null==be.current?void 0:be.current({type:"RESIZE",source:Ae.current})},[]),onOpenEnd:c(function(){return null==Re.current?void 0:Re.current({type:"OPEN"})},[]),onSnapEnd:c(function(e,n){return null==Re.current?void 0:Re.current({type:"SNAP",source:e.snapSource})},[]),onResizeEnd:c(function(){return null==Re.current?void 0:Re.current({type:"RESIZE",source:Ae.current})},[])},context:{initialState:V},services:{onSnapStart:c(function(e,n){try{return Promise.resolve(null==Pe.current?void 0:Pe.current({type:"SNAP",source:n.payload.source||"custom"}))}catch(e){return Promise.reject(e)}},[]),onOpenStart:c(function(){try{return Promise.resolve(null==Pe.current?void 0:Pe.current({type:"OPEN"}))}catch(e){return Promise.reject(e)}},[]),onCloseStart:c(function(){try{return Promise.resolve(null==Pe.current?void 0:Pe.current({type:"CLOSE"}))}catch(e){return Promise.reject(e)}},[]),onResizeStart:c(function(){try{return Promise.resolve(null==Pe.current?void 0:Pe.current({type:"RESIZE",source:Ae.current}))}catch(e){return Promise.reject(e)}},[]),onSnapEnd:c(function(e,n){try{return Promise.resolve(null==Re.current?void 0:Re.current({type:"SNAP",source:e.snapSource}))}catch(e){return Promise.reject(e)}},[]),onOpenEnd:c(function(){try{return Promise.resolve(null==Re.current?void 0:Re.current({type:"OPEN"}))}catch(e){return Promise.reject(e)}},[]),onCloseEnd:c(function(){try{return Promise.resolve(null==Re.current?void 0:Re.current({type:"CLOSE"}))}catch(e){return Promise.reject(e)}},[]),onResizeEnd:c(function(){try{return Promise.resolve(null==Re.current?void 0:Re.current({type:"RESIZE",source:Ae.current}))}catch(e){return Promise.reject(e)}},[]),renderVisuallyHidden:c(function(e,n){try{return Promise.resolve(_e({y:Xe.current,ready:0,maxHeight:Ke.current,maxSnap:Qe.current,minSnap:Xe.current,immediate:!0,topOffset:$e.current})).then(function(){})}catch(e){return Promise.reject(e)}},[_e]),activate:c(function(e,n){try{return Ee.current=!0,Promise.resolve(Promise.all([Ge.current.activate(),Ze.current.activate(),Fe.current.activate()])).then(function(){})}catch(e){return Promise.reject(e)}},[Fe,Ze,Ge]),deactivate:c(function(){try{return Ge.current.deactivate(),Ze.current.deactivate(),Fe.current.deactivate(),Ee.current=!1,Promise.resolve()}catch(e){return Promise.reject(e)}},[Fe,Ze,Ge]),openImmediately:c(function(){try{return Te.current=Xe.current,Promise.resolve(_e({y:Xe.current,ready:1,maxHeight:Ke.current,maxSnap:Qe.current,minSnap:Xe.current,immediate:!0,topOffset:$e.current})).then(function(){})}catch(e){return Promise.reject(e)}},[_e]),openSmoothly:c(function(){try{return Promise.resolve(_e({y:0,ready:1,maxHeight:Ke.current,maxSnap:Qe.current,minSnap:Xe.current,immediate:!0,topOffset:$e.current})).then(function(){return Te.current=Xe.current,Promise.resolve(_e({y:Xe.current,ready:1,maxHeight:Ke.current,maxSnap:Qe.current,minSnap:Xe.current,immediate:Ie.current,topOffset:$e.current})).then(function(){})})}catch(e){return Promise.reject(e)}},[_e,Ie]),snapSmoothly:c(function(e,n){try{var t=Ue.current(e.y);return Te.current=t,W.current=t,Promise.resolve(_e({y:t,ready:1,maxHeight:Ke.current,maxSnap:Qe.current,minSnap:Je.current,immediate:Ie.current,topOffset:$e.current,config:{velocity:e.velocity}})).then(function(){})}catch(e){return Promise.reject(e)}},[_e,W,Ie]),resizeSmoothly:c(function(){try{var e=Ue.current(Te.current);return Te.current=e,W.current=e,Promise.resolve(_e({y:e,ready:1,maxHeight:Ke.current,maxSnap:Qe.current,minSnap:Je.current,topOffset:$e.current,immediate:"element"!==Ae.current||Ie.current})).then(function(){})}catch(e){return Promise.reject(e)}},[_e,W,Ie]),closeSmoothly:c(function(e,n){try{return _e({minSnap:Te.current,immediate:!0}),Te.current=0,Promise.resolve(_e({y:0,maxHeight:Ke.current,maxSnap:Qe.current,immediate:Ie.current})).then(function(){return Promise.resolve(_e({ready:0,immediate:!0})).then(function(){})})}catch(e){return Promise.reject(e)}},[_e,Ie])}}),nn=en[0],tn=en[1];o(function(){ye&&tn(B?"OPEN":"CLOSE")},[B,tn,ye]),w(function(){(We||qe||Ve)&&tn("RESIZE")},[We,qe,Ve,tn]),o(function(){return function(){Ge.current.deactivate(),Ze.current.deactivate(),Fe.current.deactivate()}},[Fe,Ze,Ge]),s(i,function(){return{snapTo:function(e,n){var t=void 0===n?{}:n,r=t.velocity,o=void 0===r?1:r,i=t.source,a=void 0===i?"custom":i;tn("SNAP",{payload:{y:Ue.current(e),velocity:o,source:a}})},get height(){return Te.current}}},[tn]),o(function(){var e=De.current,n=function(e){Me.current&&e.preventDefault()},t=function(n){e.scrollTop<0&&(requestAnimationFrame(function(){e.style.overflow="hidden",e.scrollTop=0,e.style.removeProperty("overflow")}),n.preventDefault())};return pe&&(e.addEventListener("scroll",n),e.addEventListener("touchmove",n),e.addEventListener("touchstart",t)),function(){e.removeEventListener("scroll",n),e.removeEventListener("touchmove",n),e.removeEventListener("touchstart",t)}},[pe,De]);var rn=h(function(e){var n=e.args,t=(n=void 0===n?[]:n)[0],r=(t=void 0===t?{}:t).closeOnTap,o=void 0!==r&&r,i=t.isContentDragging,a=void 0!==i&&i,c=e.cancel,u=e.direction[1],s=e.down,l=e.first,d=e.last,f=e.memo,v=void 0===f?Ce.y.getValue():f,m=e.tap,p=e.velocity,h=-1*e.movement[1];if(!Ee.current)return c(),v;if($&&o&&m)return c(),setTimeout(function(){return $()},0),v;if(m)return v;var y=v+h,S=h*p,E=Math.max(Je.current,Math.min(Qe.current,y+2*S));if(!s&&$&&u>0&&y+S<Je.current/2)return c(),$(),v;var P=s?$||Je.current!==Qe.current?g(y,$?0:Je.current,Qe.current,.85):y<Je.current?g(y,Je.current,2*Qe.current,.85):g(y,Je.current/2,Qe.current,.85):E;return pe&&a?(P>=Qe.current&&(P=Qe.current),v===Qe.current&&De.current.scrollTop>0&&(P=Qe.current),Me.current=P<Qe.current):Me.current=!1,l&&tn("DRAG"),d?(tn("SNAP",{payload:{y:P,velocity:p>.05?p:1,source:"dragging"}}),v):(Ne({y:P,ready:1,maxHeight:Ke.current,maxSnap:Qe.current,minSnap:Je.current,topOffset:$e.current,immediate:!0,config:{velocity:p}}),v)},{filterTaps:!0});if(Number.isNaN(Qe.current))throw new TypeError("maxSnapRef is NaN!!");if(Number.isNaN(Je.current))throw new TypeError("minSnapRef is NaN!!");var on=function(e){var n,t=e.spring,r=v([t.y,t.maxHeight,t.topOffset],function(e,n,t){return Math.round(M(n-e-(t||0),0,16))+"px"}),o=v([t.y,t.minSnap,t.maxSnap],function(e,n,t){return M(e,n,t)+"px"}),i=v([t.y,t.minSnap,t.maxSnap],function(e,n,t){return e<n?n-e+"px":e>t?t-e+"px":"0px"}),a=v([t.y,t.maxSnap],function(e,n){return e>=n?Math.ceil(e-n):0}),c=v([t.y,t.minSnap],function(e,n){if(!n)return 0;var t=Math.max(n/2-45,0);return M((e-t)*(1/(Math.min(n/2+45,n)-t)+0),0,1)}),u=v([t.y,t.minSnap],function(e,n){return n?M(e/n,0,1):0});return(n={})["--rsbs-content-opacity"]=c,n["--rsbs-backdrop-opacity"]=u,n["--rsbs-antigap-scale-y"]=a,n["--rsbs-overlay-translate-y"]=i,n["--rsbs-overlay-rounded"]=r,n["--rsbs-overlay-h"]=o,n}({spring:Ce});return n.createElement(m.div,b({},he,{"data-rsbs-root":!0,"data-rsbs-state":Q.find(nn.matches),"data-rsbs-is-blocking":ie,"data-rsbs-is-dismissable":!!$,"data-rsbs-has-header":!!Z,"data-rsbs-has-footer":!!G,className:S,ref:He,style:b({},on,ue,{opacity:Ce.ready})}),p,ie&&n.createElement("div",b({key:"backdrop","data-rsbs-backdrop":!0},rn({closeOnTap:!0}))),n.createElement("div",{key:"overlay","aria-modal":"true",role:"dialog","data-rsbs-overlay":!0,tabIndex:-1,ref:Le,onKeyDown:function(e){"Escape"===e.key&&(e.stopPropagation(),$&&$())}},!1!==Z&&n.createElement("div",b({key:"header","data-rsbs-header":!0,ref:je},rn()),Z),n.createElement("div",b({key:"scroll","data-rsbs-scroll":!0,ref:De},pe?rn({isContentDragging:!0}):{}),n.createElement("div",{"data-rsbs-content":!0,ref:ke},l||n.createElement("div",{style:{position:"relative",height:"1000",overflow:"hidden"}}))),G&&n.createElement("div",b({key:"footer",ref:ze,"data-rsbs-footer":!0},rn()),G)))}),Q=["closed","opening","open","closing","dragging","snapping","resizing"];function U(e){var n=e.lastSnap;return null!=n?n:Math.min.apply(Math,e.snapPoints)}function X(e){return e.minHeight}var $=l(function(r,o){var i=r.onSpringStart,u=r.onSpringEnd,s=r.skipInitialTransition,l=R(r,["onSpringStart","onSpringEnd","skipInitialTransition"]),d=a(!1),f=d[0],v=d[1],m=t(),p=t(null),h=t(s&&l.open?"OPEN":"CLOSED");w(function(){if(l.open)return cancelAnimationFrame(m.current),v(!0),function(){h.current="CLOSED"}},[l.open]);var g=c(function(e){try{return Promise.resolve(null==i?void 0:i(e)).then(function(){"OPEN"===e.type&&cancelAnimationFrame(m.current)})}catch(e){return Promise.reject(e)}},[i]),y=c(function(e){try{return Promise.resolve(null==u?void 0:u(e)).then(function(){"CLOSE"===e.type&&(m.current=requestAnimationFrame(function(){return v(!1)}))})}catch(e){return Promise.reject(e)}},[u]);return f?n.createElement(e,{"data-rsbs-portal":!0},n.createElement(J,b({},l,{lastSnapRef:p,ref:o,initialState:h.current,onSpringStart:g,onSpringEnd:y}))):null});export{$ as BottomSheet};
//# sourceMappingURL=index.es.js.map
